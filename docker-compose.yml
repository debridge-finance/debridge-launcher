version: "3.6"
services:
  postgres:
    image: postgres
    container_name: postgres${DOCKER_ID}
    restart: on-failure
    env_file:
      - .env
    volumes:
      - ./pgdata:/var/lib/postgresql/data
      - ./pg-init-scripts:/docker-entrypoint-initdb.d
    networks:
      - debridge
  initiator:
    build: ./initiator
    image: initiator
    container_name: initiator${DOCKER_ID}
    restart: on-failure
    env_file:
      - .env
    volumes:
      - ./initiator/src/config:/config
      - ./initiator/ipfs:/home/node/ipfs
      - ./initiator/orbitdb:/home/node/orbitdb
    environment:
      - PORT=${INITIATOR_PORT}
      - DATABASE_USER=${POSTGRES_USER}
      - DATABASE_HOST=${POSTGRES_HOST}
      - DATABASE_PASSWORD=${POSTGRES_PASSWORD}
      - DATABASE_SCHEMA=${EI_DATABASE}
      - DATABASE_PORT=${POSTGRES_PORT}
      - KEYSTORE_PASSWORD=${KEYSTORE_PASSWORD}      
      - JWT_SECRET=${JWT_SECRET}
      - API_BASE_URL=${API_BASE_URL}
      - DEBRIDGE_API_ACCESS_KEY=${DEBRIDGE_API_ACCESS_KEY}
    depends_on:
      - postgres
    networks:
      - debridge
networks:
  debridge:
    name: debridge
secrets:
  keystore:
    file: ./initiator/keystore.json
